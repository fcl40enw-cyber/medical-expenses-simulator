[Uploading README.md…]()
# 在宅医療費用シミュレーター（2024年度診療報酬改定対応）

特定医療法人 新生病院の在宅医療（訪問診療）にかかる月額費用を計算するWebアプリケーションです。

## 📋 プロジェクト概要

このシミュレーターは、2024年度診療報酬改定に基づく正確な料金体系で、患者様やご家族が在宅医療の費用を事前に把握できるよう開発されました。

## ✅ 実装済み機能

### 🏠 基本機能
- **正確な診療報酬計算**: 2024年度診療報酬改定に完全対応
- **4分野別料金表示**: 在総管、訪問診療料、介護保険、自費交通費の詳細内訳
- **重症度対応**: 重症患者の高い料金設定に自動対応
- **条件入力フォーム**: 患者タイプ、重症度、年齢、保険負担割合など
- **レスポンシブデザイン**: PC・タブレット・スマートフォンに対応
- **印刷機能**: 計算結果をA4用紙1枚で印刷可能

### 🔢 4分野料金体系

#### 1. 在総管と加算（月額・保険適用）
**在宅時医学総合管理料：**
- **在総管1**: 同一日訪問患者1名
  - 月1回: 27,450円（2,745点）
  - 月2回以上（重症度なし）: 44,850円（4,485点）
  - 月2回以上（重症度あり）: 53,850円（5,385点）
- **在総管2-9**: 同一日訪問患者2-9名
  - 月1回: 14,850円（1,485点）
  - 月2回以上（重症度なし）: 23,850円（2,385点）
  - 月2回以上（重症度あり）: 44,850円（4,485点）
- **在総管10-19**: 同一日訪問患者10-19名
  - 月1回: 7,650円（765点）
  - 月2回以上（重症度なし）: 11,850円（1,185点）
  - 月2回以上（重症度あり）: 28,650円（2,865点）

**施設入居時等医学総合管理料：**
- **施設総管1**: 同一日訪問患者1名
  - 月1回: 19,650円（1,965点）
  - 月2回以上（重症度なし）: 31,850円（3,185点）
  - 月2回以上（重症度あり）: 38,850円（3,885点）
- **施設総管2-9**: 同一日訪問患者2-9名
  - 月1回: 10,650円（1,065点）
  - 月2回以上（重症度なし）: 16,850円（1,685点）
  - 月2回以上（重症度あり）: 32,250円（3,225点）
- **施設総管10-19**: 同一日訪問患者10-19名
  - 月1回: 7,650円（765点）
  - 月2回以上（重症度なし）: 11,850円（1,185点）
  - 月2回以上（重症度あり）: 28,650円（2,865点）

**在宅がん医療総合診療料：**
- **処方せん交付あり**: 17,980円/日 × 30日 = 539,400円/月（1,798点）
- **処方せん交付なし**: 20,000円/日 × 30日 = 600,000円/月（2,000点）
- **算定方式**: 1日あたりの料金を30日分で計算（訪問回数に関係なし）
- **70歳以上医療費上限額**: 月額18,000円
- **重症度分類**: なし（在総管との併用不可のため）
- **在宅患者訪問診療料**: 算定なし（在宅がん医療総合診療料に包括）

#### 2. 在宅患者訪問診療料（日額・保険適用）
- **単独訪問**: 8,880円/日（888点・同一日に1人のみ訪問）
- **複数患者訪問**: 2,030円/日（203点・同一日に2人以上訪問）

#### 3. 介護保険（居宅療養管理指導）
**月2回まで算定可能**（訪問回数が2回を超える場合も2回分のみ）：

**在宅がん医療総合診療料算定時**：
- **医師Ⅰ1（1人）**: 5,150円/回（515単位） × 最大2回
- **医師Ⅰ2（2-9人）**: 4,870円/回（487単位） × 最大2回
- **医師Ⅰ3（10人以上）**: 4,460円/回（446単位） × 最大2回

**それ以外（在総管・施設総管算定時）**：
- **医師Ⅱ1（1人）**: 2,990円/回（299単位） × 最大2回
- **医師Ⅱ2（2-9人）**: 2,870円/回（287単位） × 最大2回
- **医師Ⅱ3（10人以上）**: 2,600円/回（260単位） × 最大2回

**適用条件**: 
- 第1号被保険者（75歳以上）
- 第2号被保険者（40-64歳で要介護認定者）
- 介護保険サービス利用者（「あり」選択時のみ）

#### 4. 自費（交通費）
- **距離別交通費**（1回あたり、訪問回数で乗算）:
  - 4km未満: 無料
  - 4-6km: 509円/回
  - 6-8km: 1,019円/回
  - 8km以上: 1,528円/回

### 💰 軽減措置対応
- **福祉医療費受給者証**: 50%軽減または上限1万円
- **難病指定**: 30%軽減または上限5千円
- **高額療養費制度**: 協会けんぽ基準による所得水準別上限額適用（2024年度対応）

#### 🏥 高額療養費制度（協会けんぽ基準・2024年度）

**69歳以下の自己負担上限額**：
- **区分ア（年収約1,160万円～）**: 252,600円 + (医療費 - 842,000円) × 1%
- **区分イ（年収約770～1,160万円）**: 167,400円 + (医療費 - 558,000円) × 1%
- **区分ウ（年収約370～770万円）**: 80,100円 + (医療費 - 267,000円) × 1%
- **区分エ（年収～370万円）**: 57,600円
- **区分オ（住民税非課税）**: 35,400円

**70-74歳の自己負担上限額**：
- **現役並み所得Ⅲ（課税所得690万円以上）**: 252,600円 + (医療費 - 842,000円) × 1%
- **現役並み所得Ⅱ（課税所得380万円以上）**: 167,400円 + (医療費 - 558,000円) × 1%
- **現役並み所得Ⅰ（課税所得145万円以上）**: 80,100円 + (医療費 - 267,000円) × 1%
- **一般（課税所得145万円未満）**: 57,600円（外来：14,000円）
- **低所得Ⅱ（住民税非課税）**: 24,600円
- **低所得Ⅰ（住民税非課税・年金収入80万円以下）**: 15,000円

**75歳以上の自己負担上限額**：
- **現役並み所得Ⅲ（課税所得690万円以上）**: 252,600円 + (医療費 - 842,000円) × 1%
- **現役並み所得Ⅱ（課税所得380万円以上）**: 167,400円 + (医療費 - 558,000円) × 1%
- **現役並み所得Ⅰ（課税所得145万円以上）**: 80,100円 + (医療費 - 267,000円) × 1%
- **一般（課税所得145万円未満）**: 57,600円（外来：14,000円）
- **低所得Ⅱ（住民税非課税）**: 24,600円
- **低所得Ⅰ（住民税非課税・年金収入80万円以下）**: 15,000円

### 📊 条件分岐要素
1. **患者タイプ**: 在宅がん医療総合診療料、在総管1/2-9/10-19、施設総管1/2-9/10-19
2. **重症度**: 重症度あり、重症度なし（在総管・施設総管のみ、在宅がん医療総合診療料は対象外）
3. **処方せん交付**: あり、なし（在宅がん医療総合診療料のみ）
4. **医療保険負担割合**: 1割、2割、3割
5. **介護保険サービス利用**: あり（要介護者・第2号被保険者）、なし
6. **介護保険負担割合**: 1割、2割、3割（サービス利用時のみ）
7. **所得水準（高額療養費制度）**: 協会けんぽ基準による年齢・所得区分
   - 69歳以下: 5区分（区分ア～オ）
   - 70-74歳: 6区分（現役並み所得Ⅰ～Ⅲ、一般、低所得Ⅰ・Ⅱ）
   - 75歳以上: 6区分（現役並み所得Ⅰ～Ⅲ、一般、低所得Ⅰ・Ⅱ）
8. **距離**: 4km未満～8km以上（4段階）
9. **月間訪問日数**: 1日～15日以上
10. **特別条件**: 福祉医療費受給者、難病指定

## 🗄️ データベース構造

### テーブル: `medical_fees`
診療報酬点数表データを管理
- 患者タイプ別の基本料金
- 重症度による料金差
- 距離・職員数による加算料金

### テーブル: `simulation_results` 
シミュレーション結果を記録
- 入力条件の履歴
- 4分野別計算結果と内訳
- 実行日時

## 🌐 公開URL

**本番環境**: デプロイ後にPublishタブで確認可能
**API エンドポイント**: 
- `GET /tables/medical_fees` - 料金表データ取得
- `POST /tables/simulation_results` - 結果保存

## 🚀 使用技術

### フロントエンド
- **HTML5**: セマンティックマークアップ
- **CSS3**: レスポンシブデザイン、4分野別表示スタイル
- **JavaScript ES6+**: 診療報酬計算ロジック、DOM操作
- **Google Fonts**: Noto Sans JP
- **Font Awesome**: アイコン表示

### バックエンド
- **RESTful Table API**: データの永続化
- **JSON**: データ交換形式

## 📱 レスポンシブ対応

- **デスクトップ**: 1200px以上
- **タブレット**: 768px-1199px
- **スマートフォン**: 767px以下

## 🔧 料金体系のカスタマイズ

### 診療報酬改定への対応
`js/app.js` の `medicalFees` オブジェクトで料金を更新:

```javascript
this.medicalFees = {
    在総管: {
        '在総管1': {
            normal: 53850,   // 5,385点×10円（正確な2024年度点数）
            severe: 53850,
            description: '在宅時医学総合管理料（同一日に訪問する患者が1人）'
        }
        // ...
    }
};
```

### 距離加算の調整
`distanceFees` 配列で距離別料金を変更可能

### 軽減措置の調整
`applyReductions` メソッドで各軽減措置の割合や上限額を調整可能

## 📋 重要な修正点

### 🔄 重要な修正点
1. **正確な診療報酬点数**: 2024年度改定の正確な点数に修正
   - 在総管1: 5,385点（旧:540.8点）
   - 訪問診療料: 888点（旧:83.3点）  
   - 居宅療養管理指導: 
     - 在宅がん算定時: Ⅰ1(1人)515単位、Ⅰ2(2-9人)487単位、Ⅰ3(10人以上)446単位
     - それ以外: Ⅱ1(1人)299単位、Ⅱ2(2-9人)287単位、Ⅱ3(10人以上)260単位
2. **在総管の正しい理解**: 「月間訪問回数」→「同一日あたり訪問患者数」
3. **4分野別表示**: 料金構成を明確に分離表示
4. **重症度加算**: 2回以上訪問時の正確な加算計算
5. **正確な交通費**: 4km未満無料、4-6km:509円、6-8km:1,019円、8km以上:1,528円
6. **介護保険適用の正確性**: 第2号被保険者（40歳以上の要介護者）にも対応
7. **保険負担割合の正確適用**: 医療保険・介護保険それぞれの負担割合を適用

### 🆕 最新の修正（2024年度診療報酬正確対応）
1. **在総管・施設総管の訪問回数別料金体系**: 月の訪問回数と重症度で正確な料金計算
   - **月1回**: 全ての在総管・施設総管で独自の低い点数
   - **月2回以上（重症度なし）**: 基本料金
   - **月2回以上（重症度あり）**: 重症加算適用
   
   **在総管の正確な点数：**
   - 在総管1: 月1回 2,745点 / 月2回以上(重症度なし) 4,485点 / 月2回以上(重症度あり) 5,385点
   - 在総管2-9: 月1回 1,485点 / 月2回以上(重症度なし) 2,385点 / 月2回以上(重症度あり) 4,485点
   - 在総管10-19: 月1回 765点 / 月2回以上(重症度なし) 1,185点 / 月2回以上(重症度あり) 2,865点
   
   **施設総管の正確な点数：**
   - 施設総管1: 月1回 1,965点 / 月2回以上(重症度なし) 3,185点 / 月2回以上(重症度あり) 3,885点
   - 施設総管2-9: 月1回 1,065点 / 月2回以上(重症度なし) 1,685点 / 月2回以上(重症度あり) 3,225点
   - 施設総管10-19: 月1回 765点 / 月2回以上(重症度なし) 1,185点 / 月2回以上(重症度あり) 2,865点
3. **在宅がん医療総合診療料の正確な算定**: 日額×30日制と処方せん交付の有無に対応
   - **患者タイプ**: 「在宅がん医療総合診療料」に変更（在総管との併用不可を明確化）
   - **重症度分類**: 在宅がん医療総合診療料選択時は重症度選択を非表示
   - **算定方式**: 1日あたりの料金×30日で計算（訪問回数に関係なし）
   - **処方せん交付あり**: 17,980円/日×30日 = 539,400円/月（1,798点）
   - **処方せん交付なし**: 20,000円/日×30日 = 600,000円/月（2,000点）
   - **70歳以上医療費上限額**: 月額18,000円
   - **在宅患者訪問診療料**: 算定なし（包括済み）
4. **居宅療養管理指導の月2回上限制**: 月2回まで算定可能（訪問回数が多くても2回分まで）
5. **介護保険サービス利用の選択肢**: 「あり」「なし」の2つの選択肢に対応
6. **NaNエラーの完全修正**: 計算・表示における全てのNaN発生を防止
7. **高額療養費制度の完全実装**: 協会けんぽ基準による年齢・所得水準別上限額の適用
   - **69歳以下**: 年収区分による5段階の上限額（区分ア～オ）
   - **70-74歳**: 現役並み所得3区分と一般・低所得2区分による6段階の上限額
   - **75歳以上**: 現役並み所得3区分と一般・低所得2区分による6段階の上限額
   - **計算式**: 80,100円+(医療費-267,000円)×1%等の正確な計算式を実装
   - **表示**: 高額療養費制度適用時の詳細表示（適用前→適用後の金額表示）
   - **年齢統合**: 年齢カテゴリを削除し、所得水準選択で年齢区分も同時選択
8. **正確な料金反映**: 患者数・在総管算定状況・重症度・訪問回数・処方せん交付・年齢・所得水準による上限額に応じた正確な料金計算

### 📊 計算結果の表示
- **分野1**: 在総管と加算（月額・保険適用）
- **分野2**: 在宅患者訪問診療料と加算（日額×訪問日数・保険適用）
- **分野3**: 介護保険（居宅療養管理指導）（日額×訪問日数・介護保険適用）
- **分野4**: 自費（交通費）（距離別料金×訪問日数・全額自己負担）

**最終料金**: 各分野に保険負担割合を適用後の自己負担額の合算

### 💰 保険適用の計算方式

**医療保険適用部分**：
- 在総管 + 在宅患者訪問診療料に医療保険負担割合（1-3割）を適用

**介護保険適用部分**：
- 居宅療養管理指導に介護保険負担割合（1-3割）を適用

**自費部分**：
- 交通費は全額自己負担（保険適用外）

**計算例1（在総管1・月1回・1割負担・距離4-6km）**：
```
【保険適用前】
1. 在総管1（月1回）: ¥27,450（医療保険・月額）
2. 訪問診療料: ¥8,880（医療保険・8,880円×1日）  
3. 居宅療養管理指導: ¥2,990（介護保険・Ⅱ1・299単位×1回・1人）
4. 交通費: ¥509（自費・509円×1回）
合計: ¥39,829

【保険適用後（自己負担額）】
1. 在総管1: ¥27,450 → ¥2,745（1割負担）
2. 訪問診療料: ¥8,880 → ¥888（1割負担）
3. 居宅療養管理指導: ¥2,990 → ¥299（1割負担）  
4. 交通費: ¥509（変更なし）
────────────────────
月額自己負担額: ¥4,441
```

**計算例2（在総管1・月2回以上・重症度なし・1割負担・距離4-6km）**：
```
【保険適用前】
1. 在総管1（月2回以上・重症度なし）: ¥44,850（医療保険・月額）
2. 訪問診療料: ¥17,760（医療保険・8,880円×2日）  
3. 居宅療養管理指導: ¥5,980（介護保険・Ⅱ1・299単位×2回・1人）
4. 交通費: ¥1,018（自費・509円×2回）
合計: ¥69,608

【保険適用後（自己負担額）】
1. 在総管1: ¥44,850 → ¥4,485（1割負担）
2. 訪問診療料: ¥17,760 → ¥1,776（1割負担）
3. 居宅療養管理指導: ¥5,980 → ¥598（1割負担）  
4. 交通費: ¥1,018（変更なし）
────────────────────
月額自己負担額: ¥7,877
```

**計算例3（在総管1・月2回以上・重症度あり・1割負担・距離4-6km）**：
```
【保険適用前】
1. 在総管1（月2回以上・重症度あり）: ¥53,850（医療保険・月額）
2. 訪問診療料: ¥17,760（医療保険・8,880円×2日）  
3. 居宅療養管理指導: ¥5,980（介護保険・Ⅱ1・299単位×2回・1人）
4. 交通費: ¥1,018（自費・509円×2回）
合計: ¥78,608

【保険適用後（自己負担額）】
1. 在総管1: ¥53,850 → ¥5,385（1割負担）
2. 訪問診療料: ¥17,760 → ¥1,776（1割負担）
3. 居宅療養管理指導: ¥5,980 → ¥598（1割負担）  
4. 交通費: ¥1,018（変更なし）
────────────────────
月額自己負担額: ¥8,777
```

**計算例（在総管1・重症度なし・月4回・1割負担・距離4-6km）**：
```
【保険適用前】
1. 在総管1（重症度なし）: ¥44,850（医療保険・月額）
2. 訪問診療料: ¥35,520（医療保険・8,880円×4日）  
3. 居宅療養管理指導: ¥5,980（介護保険・Ⅱ1・299単位×2回※上限・1人）
4. 交通費: ¥2,036（自費・509円×4回）
合計: ¥88,386

【保険適用後（自己負担額）】
1. 在総管1: ¥44,850 → ¥4,485（1割負担）
2. 訪問診療料: ¥35,520 → ¥3,552（1割負担）
3. 居宅療養管理指導: ¥5,980 → ¥598（1割負担）  
4. 交通費: ¥2,036（変更なし）
────────────────────
月額自己負担額: ¥10,671
```

**計算例（在総管2-9・重症度なし・月2回・1割負担・距離4-6km）**：
```
【保険適用前】
1. 在総管2-9（重症度なし）: ¥23,850（医療保険・月額）
2. 訪問診療料: ¥4,060（医療保険・2,030円×2日）  
3. 居宅療養管理指導: ¥5,740（介護保険・Ⅱ2・287単位×2回・2-9人）
4. 交通費: ¥1,018（自費・509円×2回）
合計: ¥34,668

【保険適用後（自己負担額）】
1. 在総管2-9: ¥23,850 → ¥2,385（1割負担）
2. 訪問診療料: ¥4,060 → ¥406（1割負担）
3. 居宅療養管理指導: ¥5,740 → ¥574（1割負担）  
4. 交通費: ¥1,018（変更なし）
────────────────────
月額自己負担額: ¥4,383
```

**計算例（施設総管1・月1回・1割負担・距離4-6km）**：
```
【保険適用前】
1. 施設総管1（月1回）: ¥19,650（医療保険・月額）
2. 訪問診療料: ¥8,880（医療保険・8,880円×1日）  
3. 居宅療養管理指導: ¥2,990（介護保険・Ⅱ1・299単位×1回・1人）
4. 交通費: ¥509（自費・509円×1回）
合計: ¥32,029

【保険適用後（自己負担額）】
1. 施設総管1: ¥19,650 → ¥1,965（1割負担）
2. 訪問診療料: ¥8,880 → ¥888（1割負担）
3. 居宅療養管理指導: ¥2,990 → ¥299（1割負担）  
4. 交通費: ¥509（変更なし）
────────────────────
月額自己負担額: ¥3,661
```

**計算例（在宅がん医療総合診療料・処方せん交付あり・月10回訪問・70歳以上1割負担・距離4-6km）**：
```
【保険適用前】
1. 在宅がん医療総合診療料: ¥539,400（医療保険・17,980円×30日）
2. 居宅療養管理指導: ¥10,300（介護保険・Ⅰ1・515単位×2回上限・通常）
3. 交通費: ¥5,090（自費・509円×10回）
合計: ¥554,790

【保険適用後（自己負担額）】
1. 在宅がん医療総合診療料: ¥539,400 → ¥18,000（70歳以上上限額適用）
2. 居宅療養管理指導: ¥10,300 → ¥1,030（1割負担）  
3. 交通費: ¥5,090（変更なし）
────────────────────
月額自己負担額: ¥24,120
```

**計算例（在宅がん医療総合診療料・処方せん交付なし・月5回訪問・69歳以下1割負担・距離4-6km）**：
```
【保険適用前】
1. 在宅がん医療総合診療料: ¥600,000（医療保険・20,000円×30日）
2. 居宅療養管理指導: ¥10,300（介護保険・Ⅰ1・515単位×2回上限・通常）
3. 交通費: ¥2,545（自費・509円×5回）
合計: ¥612,845

【保険適用後（自己負担額）】
1. 在宅がん医療総合診療料: ¥600,000 → ¥60,000（1割負担）
2. 居宅療養管理指導: ¥10,300 → ¥1,030（1割負担）  
3. 交通費: ¥2,545（変更なし）
────────────────────
月額自己負担額: ¥63,575
```

### 🖨️ 印刷機能

**特徴**:
- **A4用紙1枚対応**: 計算結果が1枚に収まるよう最適化
- **病院ヘッダー**: 新生病院の正式名称とロゴ的デザイン
- **計算条件表示**: 入力された条件を一覧で表示
- **詳細内訳**: 4分野別の料金内訳を見やすく配置
- **高額療養費制度表示**: 適用時のハイライト表示
- **免責事項**: 適切な注意事項を記載
- **日時記録**: 計算実行日時をフッターに表示

**使用方法**:
1. 料金計算を実行後、「計算結果を印刷する」ボタンが表示
2. ボタンクリックで印刷プレビューが自動的に開く
3. A4用紙で適切にレイアウトされた結果を印刷

## 🎯 推奨次ステップ

1. **実地での料金検証**: 実際の診療報酬請求との照合
2. **地域係数対応**: 地域別の診療報酬係数への対応
3. **加算項目の拡張**: 夜間・休日・緊急時加算の追加
4. **管理機能**: 料金表の動的更新機能

## 🛠️ 開発・テスト

### ファイル構造
```bash
├── index.html          # メインページ（修正済み）
├── css/
│   └── style.css      # 4分野表示対応スタイル
├── js/
│   └── app.js         # 2024年度診療報酬対応ロジック
└── README.md          # 更新済みプロジェクト説明
```

### 動作確認項目
1. 各患者タイプでの正確な計算
2. 重症度加算の適用確認
3. 4分野別料金の正確な表示
4. 保険適用・軽減措置の計算検証
5. レスポンシブデザインの確認

## 📞 お問い合わせ

**特定医療法人　新生病院**
- 在宅医療についてのご相談は病院までお電話ください
- 受付時間：平日 9:00-17:00

## ⚠️ 免責事項

このシミュレーターは2024年度診療報酬改定に基づく概算料金を表示するものです。実際の料金は以下により変動する場合があります：
- 個別の診療内容・検査・処置
- 地域係数や施設基準
- 保険適用状況の個別判定
- その他の加算項目

詳細は医療機関にお問い合わせください。

---

*2024年度診療報酬改定対応版 - 正確な料金体系による信頼性の高いシミュレーション*
